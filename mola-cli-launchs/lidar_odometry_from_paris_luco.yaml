# -----------------------------------------------------------------------------
#                        SLAM system definition for MOLA
# This file defines:
# An input sensor from a ROS 2 topic, and the MOLA Visualizer.
# -----------------------------------------------------------------------------

modules:
  # =====================
  # MolaViz
  # =====================
  - name: viz
    type: mola::MolaViz
    verbosity_level: '${MOLA_VERBOSITY_MOLA_VIZ|INFO}'
    params: ~ # none

# Offline or online sensory data sources =====================
  # =====================
  # ParisLucoDataset
  # =====================
  - type: mola::ParisLucoDataset
    name: dataset_input
    execution_rate: 20 # Hz
    #export_to_rawlog: paris_luco.rawlog
    #verbosity_level: INFO
    quit_mola_app_on_dataset_end: ${MOLA_QUIT_ON_DATASET_END|false}
    
    gui_preview_sensors:
      - raw_sensor_label: lidar
        decimation: 1
        win_pos: 5 70 400 400
    params:
      base_dir: ${PARIS_LUCO_BASE_DIR}
      sequence: '00'  # There is only one sequence in this dataset
      time_warp_scale: 1.0
      start_paused: ${MOLA_DATASET_START_PAUSED|false}

  - name: lidar_odom
    type: mola::LidarOdometry
    verbosity_level: '${MOLA_VERBOSITY_MOLA_LO|INFO}'
    raw_data_source: 'dataset_input'
    # This includes here a whole block "params: (...)"
    # with the LIDAR-Odometry pipeline configuration:
    params: '${MOLA_ODOMETRY_PIPELINE_YAML|../pipelines/lidar3d-default.yaml}'

  - name: state_estimation
    type: '${MOLA_STATE_ESTIMATOR|mola::state_estimation_simple::StateEstimationSimple}'
    verbosity_level: '${MOLA_VERBOSITY_MOLA_STATE_ESTIMATOR|INFO}'

    # This includes here a whole block "params: (...)":
    params: '${MOLA_STATE_ESTIMATOR_YAML|../state-estimator-params/state-estimation-simple.yaml}'

